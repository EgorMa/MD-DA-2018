---
title: "Lab2"
author: "Manin Egor Ri-450005"
date: '8 октября 2018 г '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Исходные данные
Установленная среда R включает в себя набор заранее сконфигурированных массивов данных. В данной лабораторной требуется использовать одну из них — датафрейм из 93 машин-новинок 1993 года. Для того, чтобы загрузить данный датафрейм, необходимо выполнить следующие команды:
```{r}
library(MASS)
data(Cars93)
```
Для того, чтобы ознакомиться со структурой и составом данных, можно выполнить команду View(Cars93) или нажать на соответствующую кнопку в RStudio.
```{r}
View(Cars93)
```
Задание 1
Выполните команду summary() на полном наборе данных. Можно ли по результату выполнения сказать сколько строк в датафрейме? Если да, напишите сколько. Если нет, то приведите другой способ.
```{r}
summary(Cars93)
```
Можно получить искомое количество строк, дополнительно сложив все цифры в столбце Manufacturer или Make, всего будет 93 строки, но также можно использовать команду nrow(Cars93)
```{r}
nrow(Cars93)
```
Найдите среднюю цену машин с задним приводом.
```{r}
rear<-(Cars93[,"DriveTrain"]=="Rear")
mean(Cars93[rear,"Price"])
```
Найдите минимальное число лошадиных сил автомобиля для 7 пассажиров. Для 6 пассажиров.
```{r}
pass<-(Cars93[,"Passengers"]==6)
min(Cars93[pass,"Horsepower"])
```
Для 7 пассажиров
```{r}
pass<-(Cars93[,"Passengers"]==7)
min(Cars93[pass,"Horsepower"])
```
Найдите машины с максимальным, минимальным и средним(медианой) расстоянием, которая машина может проехать по трассе. Вам понадобятся 2 колонки, чтобы рассчитать расстояние. Какие?
Нам понадобится две колонки - MPG.highway, которая показывает сколько миль машина может пройти на один литр топлива по трассе, и колонка Fuel.tank.capacity, которая показывает вместимость бензобака.
```{r}
Length <- Cars93$MPG.highway * Cars93$Fuel.tank.capacity
Cars93$Make[which(Length == max(Length))]
Cars93$Make[which(Length == min(Length))]
Cars93$Make[which(Length == median(Length))]
```
В самом начале занятий приводился пример с фабрикой и производством автомобилей. Ниже приведён пример кода, который старается оптимизировать выпуск продукции ориентируясь на доступные ресурсы.
Выполните код и запустите эту функцию factory.run().
```{r}
factory.run <- function (o.cars=1, o.trucks=1) {
  factory <- matrix(c(40,1,60,3),nrow=2, dimnames=list(c("трудодни","сталь"),c("автомобили","грузовики")))
  warehouse <- c(1600,70) #Доступно материалов на складе
  names(warehouse) <- rownames(factory)
  reserve <- c(8,1)
  names(reserve) <- rownames(factory)
  output <- c(o.cars, o.trucks)
  names(output) <- colnames(factory)
  
  steps <- 0 # Счётчик числа шагов цикла
  repeat {
    steps <- steps + 1
    needed <- factory %*% output # Подсчитаем ресурсы, которые нам нужны для производства требуемого кол-ва машин
   # message(steps)
   # print(needed)
    # Если ресурсов достаточно и остаток меньше или равен резерву, то мы произвели максимум возможного.
    # Нужно прекращать
    if (all(needed <= warehouse) && all((warehouse - needed) <= reserve)) {
      break()
    }
    # Если заявка слишком большая и ресурсов недостаточно, уменьшим её на 10%
    if (all(needed > warehouse)) {
      output <- output * 0.9
      next()
    }
    # Если всё наоброт, то увеличим на 10%
    if (all(needed < warehouse)) {
      output <- output * 1.1
      next()
    }
    # Если мы потребили одного ресурса слишком много, а другого недостаточно,
    # то увеличим план на случайную величину
    output <- output * (1+runif(length(output),min=-0.1,max=0.1))
  }
  
  return(output)
}
factory.run()

```
С каким входными значениями функция вызвана? Какой получился результат?
Входные значения o.cars=1, o.trucks=1, получили результат 9 автомобилей и 20 грузовиков.
Повторите вызов 4 раза. Полученные ответы отличаются от полученных ранее? Если да, почему? Если нет, почему?
Ответы, отличаются, поскольку мы увеличиваем план на случайную величину от -0.1 до 0.1
В приведённом коде, переменные steps и output находятся внутри алгоритма. Измените функцию так, чтобы она возвращала число шагов и произведённое количество машин.
```{r}
factory.run <- function (o.cars=1, o.trucks=1) {
  factory <- matrix(c(40,1,60,3),nrow=2, dimnames=list(c("трудодни","сталь"),c("автомобили","грузовики")))
  warehouse <- c(1600,70) #Доступно материалов на складе
  names(warehouse) <- rownames(factory)
  reserve <- c(8,1)
  names(reserve) <- rownames(factory)
  output <- c(o.cars, o.trucks)
  names(output) <- colnames(factory)
  
  steps <- 0 # Счётчик числа шагов цикла
  repeat {
    steps <- steps + 1
    needed <- factory %*% output # Подсчитаем ресурсы, которые нам нужны для производства требуемого кол-ва машин
   # message(steps)
   # print(needed)
    # Если ресурсов достаточно и остаток меньше или равен резерву, то мы произвели максимум возможного.
    # Нужно прекращать
    if (all(needed <= warehouse) && all((warehouse - needed) <= reserve)) {
      break()
    }
    # Если заявка слишком большая и ресурсов недостаточно, уменьшим её на 10%
    if (all(needed > warehouse)) {
      output <- output * 0.9
      next()
    }
    # Если всё наоброт, то увеличим на 10%
    if (all(needed < warehouse)) {
      output <- output * 1.1
      next()
    }
    # Если мы потребили одного ресурса слишком много, а другого недостаточно,
    # то увеличим план на случайную величину
    output <- output * (1+runif(length(output),min=-0.1,max=0.1))
  }
  vec<-c(steps,output)
  names(vec)<-c("steps","автомобили", "грузовики")
  return(vec)
}
factory.run()

```
Установите план равный тридцати автомобилям и 20 грузовикам и выполните функцию.
Какой получили результат?
Каким получился итоговый запрос ресурсов (переменная needed)
Как много итераций пришлось пройти, чтобы получить ответ (переменная steps)?
Для подсчёта можно пользоваться функциями печати (print, message) или вернуть результат из функции.
```{r}
factory.run <- function (o.cars=1, o.trucks=1) {
  factory <- matrix(c(40,1,60,3),nrow=2, dimnames=list(c("трудодни","сталь"),c("автомобили","грузовики")))
  warehouse <- c(1600,70) #Доступно материалов на складе
  names(warehouse) <- rownames(factory)
  reserve <- c(8,1)
  names(reserve) <- rownames(factory)
  output <- c(o.cars, o.trucks)
  names(output) <- colnames(factory)
  
  steps <- 0 # Счётчик числа шагов цикла
  repeat {
    steps <- steps + 1
    needed <- factory %*% output # Подсчитаем ресурсы, которые нам нужны для производства требуемого кол-ва машин
   # message(steps)
   # print(needed)
    # Если ресурсов достаточно и остаток меньше или равен резерву, то мы произвели максимум возможного.
    # Нужно прекращать
    if (all(needed <= warehouse) && all((warehouse - needed) <= reserve)) {
      break()
    }
    # Если заявка слишком большая и ресурсов недостаточно, уменьшим её на 10%
    if (all(needed > warehouse)) {
      output <- output * 0.9
      next()
    }
    # Если всё наоброт, то увеличим на 10%
    if (all(needed < warehouse)) {
      output <- output * 1.1
      next()
    }
    # Если мы потребили одного ресурса слишком много, а другого недостаточно,
    # то увеличим план на случайную величину
    output <- output * (1+runif(length(output),min=-0.1,max=0.1))
  }
  vec<-c(steps,output, needed)
  names(vec)<-c("steps","автомобили", "грузовики", "Трудодни", "сталь")
  return(vec)
}
factory.run(o.cars = 30, o.trucks = 20)

```
Результаты будут выведены при запуске кода, при заданном количестве автомобилей и грузовиков оптимизация невозможна. Например, при выполненных 18678 шагах было использовано 1598 трудодней и 69 стали

