---
title: "Lab3"
author: "Manin Egor Ri-450005"
date: '10 октября 2018 г '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Файл forbes.htm содержит список богатейших американцев по версии журнала Форбс. На его примере потренируемся в разборе html страниц.

Задание 1
Используйте команду readLines для загрузки файла в текстовый вектор html.
Сколько строк в файле?
Сколько символов в файле?
```{r}
html <- readLines("https://raw.githubusercontent.com/SergeyMirvoda/MD-DA-2018/master/data/forbes.htm")
length(html)
sum(nchar(html))
```
Откройте файл в текстовом редакторе. Найдите строки, содержащие данные о Билле Гейтсе и Ларри Эллисоне и запомните размер их дохода.
Bill Gates 72 Billion $
Larry Ellison 41 Billion $
Напишите шаблон регулярного выражения и используйте функцию grep, чтобы извлечь размер дохода из данных в векторе html. Удостоверьтесь, что полученный вектор номеров строк содержит содержит ровно 100 записей и ссылается на номера строк в котрых действительно есть информация о доходе, а не просто первый попавшийся текст.
```{r}
money<- grep("^\\s+<td\\sclass=\"worth\">\\$(\\d+|\\d+,\\d+)\\sB</td>$", html, value = TRUE)
length(money)
```
Напишите код, использовав регулярное выражение из п. 3, и функции regexp и regmatches, чтобы извлечь все данные о доходе. Проверьте следующее:
Должно быть ровно сто значений.
```{r}
filtered <- regexpr("\\$(\\d+|\\d+,\\d+)\\sB", money)
result <- regmatches(money, filtered)
filtered
result
```

Должно быть ровно сто значений.
```{r}
length(result)
```
Самый большой доход должен быть доход Билла Гейтса
```{r}
result[1]
```
Такой доход должен быть в списке один раз.
```{r}
length(grep("$72 B", result, fixed = TRUE)) == 1
```
В всписке должна быть цифра, которую мы запомнили для Ларри Эллисона.
```{r}
length(grep("$41 B", result, fixed = TRUE)) > 0
```
Должно быть как минимум два значения, встречающихся несколько раз.
```{r}
length(grep("$36 B", result, fixed = TRUE)) > 1
length(grep("$20,5 B", result, fixed = TRUE)) > 1
length(grep("$14 B", result, fixed = TRUE)) > 1
```
В данных доход представлен в формате "$42 B", что означает 42 × 10^9. Преобразуйте этот формат в числовой и сохраните в вектор worths. Удостоверьтесь в следующем:
```{r}
filtered <- regexpr("(\\d+|,\\d+)", result)
filtered <- regmatches(result, filtered)
filtered <- gsub(",", ".", filtered)
worths <- as.double(filtered) * 1e9
worths
remove(filtered)
```
worths является вектором и в нём сто занчений типа double.
```{r}
is.vector(worths)
is.double(worths)
length(worths)
```
Все элементы вектора worths больше 1 миллиарда.
```{r}
all(worths > 1e9)
```
Самое большое число это доход Билла Гейтса.э=
```{r}
max(worths) == 7.2e10
```
Используйте вектор worths , чтобы выяснить следующее:
Какова медиана ста этих записей?
```{r}
median(worths)
```
Средний доход?
```{r}
mean(worths)
```
Как много людей из этого списка имеют доход больше 5млрд., 10, 25?
```{r}
length(which(worths > 5e9))
length(which(worths > 1e10))
length(which(worths > 2.5e10))
```
Какой их общий доход?
```{r}
sum(worths)
```
Какую долю от общего дохода, составляет пятёрка самых богатых.
```{r}
sum(worths[1:5]) / sum(worths)
```
Какую долю от общего дохода, составляют 20 самых богатых.
```{r}
sum(worths[1:20]) / sum(worths)
```
В данных федеральный резерв США, после 2015 (24 страница) Федеральный резерс США, до 2013 (123 страница) найдите показатель дохода всех домохозяйств (Household net worth) в соответвующем году, какую долю общего дохода составляют 100 богатейших людей.
```{r}
c<-7.8536e13
sum(worths) / c
```

